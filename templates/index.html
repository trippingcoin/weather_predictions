<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Weather Rain Prediction</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #74b9ff, #dfe6e9);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
    }

    .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 6px 30px rgba(0, 0, 0, 0.2);
      padding: 35px;
      width: 420px;
      text-align: center;
      transition: transform 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    h2 {
      color: #0984e3;
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-weight: 600;
      color: #2d3436;
      margin-top: 10px;
      text-align: left;
    }

    select,
    input {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #b2bec3;
      border-radius: 6px;
      font-size: 15px;
      outline: none;
      transition: all 0.2s;
    }

    select:focus,
    input:focus {
      border-color: #0984e3;
      box-shadow: 0 0 5px rgba(9, 132, 227, 0.4);
    }

    button {
      width: 100%;
      background: linear-gradient(90deg, #0984e3, #00cec9);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      padding: 12px;
      margin-top: 25px;
      cursor: pointer;
      transition: all 0.3s;
    }

    button:hover {
      background: linear-gradient(90deg, #00cec9, #0984e3);
      transform: scale(1.02);
    }

    .result {
      margin-top: 30px;
      padding: 15px;
      border-radius: 10px;
      background: #f1f2f6;
      font-size: 17px;
      line-height: 1.5em;
      color: #2d3436;
    }

    .loading {
      font-style: italic;
      color: #636e72;
      margin-top: 20px;
    }

    .rain {
      color: #0984e3;
      font-weight: bold;
    }

    .sun {
      color: #00b894;
      font-weight: bold;
    }

    footer {
      position: fixed;
      bottom: 10px;
      font-size: 13px;
      color: #636e72;
    }
  </style>
</head>

<body>

  <div class="card">
    <h2>Rain Prediction System</h2>

    <label for="city">Select City</label>
    <select id="city">
      <optgroup label="Kazakhstan Cities">
        <option>Astana</option>
        <option>Almaty</option>
        <option>Shymkent</option>
        <option>Akmola (Kokshetau)</option>
        <option>Atyrau</option>
        <option>Aktobe</option>
        <option>Abai (Semey)</option>
        <option>Ulytau (Zhezqazghan)</option>
        <option>Jetisu (Taldykorgan)</option>
        <option>Oskemen</option>
        <option>Karaganda</option>
        <option>Kostanay</option>
        <option>Kyzylorda</option>
        <option>Mangystau (Aktau)</option>
        <option>Petropavl</option>
        <option>Pavlodar</option>
        <option>Turkistan</option>
        <option>Oral</option>

      <optgroup label="Europe Capitals">
        <option>Vienna (Austria)</option>
        <option>Brussels (Belgium)</option>
        <option>Sofia (Bulgaria)</option>
        <option>Zagreb (Croatia)</option>
        <option>Prague (Czech Republic)</option>
        <option>Copenhagen (Denmark)</option>
        <option>Tallinn (Estonia)</option>
        <option>Helsinki (Finland)</option>
        <option>Paris (France)</option>
        <option>Berlin (Germany)</option>
        <option>Athens (Greece)</option>
        <option>Budapest (Hungary)</option>
        <option>Reykjavik (Iceland)</option>
        <option>Dublin (Ireland)</option>
        <option>Rome (Italy)</option>
        <option>Riga (Latvia)</option>
        <option>Vilnius (Lithuania)</option>
        <option>Luxembourg (Luxembourg)</option>
        <option>Valletta (Malta)</option>
        <option>Chisinau (Moldova)</option>
        <option>Monaco (Monaco)</option>
        <option>Podgorica (Montenegro)</option>
        <option>Amsterdam (Netherlands)</option>
        <option>Skopje (North Macedonia)</option>
        <option>Oslo (Norway)</option>
        <option>Warsaw (Poland)</option>
        <option>Lisbon (Portugal)</option>
        <option>Bucharest (Romania)</option>
        <option>Belgrade (Serbia)</option>
        <option>Bratislava (Slovakia)</option>
        <option>Ljubljana (Slovenia)</option>
        <option>Madrid (Spain)</option>
        <option>Stockholm (Sweden)</option>
        <option>Bern (Switzerland)</option>
        <option>Kyiv (Ukraine)</option>
        <option>London (United Kingdom)</option>
      </optgroup>
    </select>

    <label for="hours">Forecast Hours Ahead</label>
    <input type="number" id="hours" value="3" min="0" step="1">

    <label for="model">Machine Learning Model</label>
    <select id="model">
      <optgroup label="Tree-Based Models">
        <option>Decision Tree</option>
        <option>Random Forest</option>
        <option>Extra Trees</option>
        <option>Gradient Boosting</option>
        <option>Hist Gradient Boosting</option>
        <option>XGBoost</option>
      </optgroup>

      <optgroup label="Linear Models">
        <option>Logistic Regression</option>
        <option>Lasso (SGDClassifier)</option>
        <option>Ridge Classifier</option>
        <option>Perceptron</option>
        <option>Passive Aggressive</option>
      </optgroup>

      <optgroup label="Kernel & Distance Models">
        <option>SVM (RBF)</option>
        <option>KNN</option>
      </optgroup>

      <optgroup label="Ensemble / Boosting">
        <option>AdaBoost</option>
        <option>Bagging</option>
      </optgroup>

      <optgroup label="Probabilistic Models">
        <option>Naive Bayes</option>
      </optgroup>

      <optgroup label="Deep Learning">
        <option>Deep Learning (MLP)</option>
      </optgroup>

      <optgroup label="Ensemble Blending">
        <option>Ensemble Blending</option>
      </optgroup>

      <optgroup label="Stacking Ensemble">
        <option>Stacking Ensemble</option>
      </optgroup>

      <optgroup label="✨ Auto Selection">
        <option value="best">Auto (Best Model)</option>
      </optgroup>
    </select>

    <button onclick="predict()">Predict Rain</button>

    <div id="loading" class="loading" style="display:none;">Loading prediction...</div>
    <div id="result" class="result"></div>
    <div id="output" class="result"></div>
    <div id="accuracy" class="accuracy"></div>
  </div>

  <footer>Made with ❤️ by Torekhan Pugashbek</footer>

  <script>
    async function predict() {
      const city = document.getElementById('city').value;
      const hours = parseFloat(document.getElementById('hours').value);
      const model = document.getElementById('model').value;
      const resultDiv = document.getElementById('result');
      const loading = document.getElementById('loading');

      resultDiv.innerHTML = '';
      loading.style.display = 'block';

      try {
        const res = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ city, hours_ahead: hours, model })
        });

        const data = await res.json();
        loading.style.display = 'none';

        if (data.error) {
          resultDiv.innerHTML = `<span style="color:red;"> ${data.error}</span>`;
          return;
        }

        const prob = data.rain_probability;
        const acc = data.accuracy;
        const cityName = data.city;
        const time = data.datetime;
        const modelName = data.model || "Unknown";
        const usedModel = data.used_model || modelName;
        const isBest = data.is_best_model;

        const modelDisplay = isBest
          ? `Best Model (${usedModel})`
          : usedModel;

        resultDiv.innerHTML = `
        <div><b>${cityName}</b><br>
        Forecast Time: ${time}</div><hr>
        <div>Rain Probability:
          <span class="${prob >= 50 ? 'rain' : 'sun'}">${prob}%</span>
        </div>
        <div><b>Model Used:</b> ${modelDisplay}</div>
        <div>Accuracy: <b>${acc}%</b></div>
        <div><b>Prediction:</b> ${prob >= 60
            ? "High chance of rain!"
            : prob >= 30
              ? "Possible light rain."
              : "Mostly clear."
          }</div>
      `;
      } catch (err) {
        loading.style.display = 'none';
        resultDiv.innerHTML = `<span style="color:red;">Request failed: ${err.message}</span>`;
      }
    }
  </script>
</body>

</html>